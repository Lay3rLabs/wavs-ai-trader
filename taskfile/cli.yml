version: "3"

includes:
  config:
    taskfile: ./config.yml
    flatten: true

tasks:
  wavs:
    desc: "Run WAVS CLI commands in Docker container"
    vars:
      WAVS_INSTANCE: "{{.WAVS_INSTANCE | default 1}}"
      WAVS_COSMOS_SUBMISSION_MNEMONIC:
        sh: task backend:get-wavs-cosmos-submission-mnemonic-{{.WAVS_INSTANCE}}
      WAVS_SUBMISSION_MNEMONIC:
        sh: task backend:get-wavs-cosmos-submission-mnemonic-{{.WAVS_INSTANCE}}
    cmds:
      - >
        {{.DOCKER_SUDO}} docker run --rm --network host
        -e WAVS_SUBMISSION_MNEMONIC="{{.WAVS_SUBMISSION_MNEMONIC}}"
        -v {{.REPO_ROOT}}:/wavs-tools
        -v {{.WAVS_HOME_DIR}}:/wavs-home 
        {{.WAVS_DOCKER_IMAGE}}
        wavs-cli {{.CLI_ARGS}}
